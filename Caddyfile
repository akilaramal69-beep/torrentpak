{
    email {$EMAIL}
}

# Main Site & API
{$DOMAIN} {
    # Main Application
    reverse_proxy app:5000
    
    # Jackett UI via path (Uses main domain SSL)
    # Accessible at https://yourdomain.com/jackett/
    handle_path /jackett* {
        reverse_proxy jackett:9117 {
            header_up X-Forwarded-Host {host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # Security Headers
    header {
        Strict-Transport-Security "max-age=63072000"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        X-Frame-Options "DENY"
        -Server
    }
}

# Optional: Jackett Subdomain (Only works if you have 'jackett' A record)
jackett.{$DOMAIN} {
    reverse_proxy jackett:9117 {
        header_up X-Forwarded-Host {host}
        header_up X-Forwarded-Proto {scheme}
    }
}

# WWW redirect
www.{$DOMAIN} {
    redir https://{$DOMAIN}{uri} permanent
}

# Fallback for IP access (No SSL)
:80 {
    reverse_proxy app:5000
    handle_path /jackett* {
        reverse_proxy jackett:9117
    }
}
