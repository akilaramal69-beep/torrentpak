import{r,j as s,C as S,R as C}from"./index-83b567b2.js";import{pikpak as m}from"./cloudService-939a736f.js";const b=a=>{const n=parseInt(a);if(isNaN(n))return"0 B";const l=1024,o=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(n)/Math.log(l));return parseFloat((n/Math.pow(l,c)).toFixed(2))+" "+o[c]},_=({isOpen:a,onClose:n})=>{const[l,o]=r.useState("tasks"),[c,g]=r.useState([]),[j,v]=r.useState([]),[h,i]=r.useState(null),[d,x]=r.useState([]),[u,N]=r.useState(null);r.useEffect(()=>{a&&w()},[a]),r.useEffect(()=>{let e;return a&&l==="tasks"&&(f(),e=setInterval(f,5e3)),()=>clearInterval(e)},[a,l]),r.useEffect(()=>{a&&l==="files"&&y(h)},[a,l,h]);const w=async()=>{try{const e=await m.getUser();N(e)}catch(e){console.error(e)}},f=async()=>{try{const e=await m.getTasks();g(e.tasks||[])}catch(e){console.error(e)}},y=async e=>{try{const t=await m.getFiles(e||void 0);v(t.files||[])}catch(t){console.error(t)}},p=(e,t)=>{e===null?(i(null),x([])):(i(e),x(E=>[...E,{id:e,name:t}]))},k=()=>{if(d.length<=1)i(null),x([]);else{const e=d.slice(0,-1);x(e),i(e[e.length-1].id)}};return a?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:s.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800 bg-slate-800/50",children:[s.jsx("h2",{className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-cyan-300",children:"Cloud Drive"}),s.jsx("button",{onClick:n,className:"text-slate-400 hover:text-white transition-colors",children:s.jsx(S,{})})]}),s.jsx("div",{className:"flex-1 overflow-auto p-4",children:s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"flex gap-2 mb-4",children:[s.jsx("button",{onClick:()=>o("tasks"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${l==="tasks"?"bg-sky-600 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:"Active Transfers"}),s.jsx("button",{onClick:()=>o("files"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${l==="files"?"bg-sky-600 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:"All Files"}),s.jsx("div",{className:"flex-1"}),u&&s.jsxs("span",{className:"text-sm text-slate-500 self-center",children:["Welcome, ",u.username]})]}),l==="tasks"&&s.jsx("div",{className:"space-y-3",children:c.length===0?s.jsx("p",{className:"text-center text-slate-500 py-8",children:"No active transfers"}):c.map(e=>{var t;return s.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{className:"font-medium text-slate-200 truncate pr-4",title:e.name,children:e.name}),s.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${e.phase==="PHASE_TYPE_COMPLETE"?"bg-green-900/50 text-green-400":e.phase==="PHASE_TYPE_ERROR"?"bg-red-900/50 text-red-400":"bg-sky-900/50 text-sky-400"}`,children:(t=e.phase)==null?void 0:t.replace("PHASE_TYPE_","")})]}),s.jsx("div",{className:"w-full bg-slate-700 h-1.5 rounded-full overflow-hidden",children:s.jsx("div",{className:"bg-sky-500 h-full transition-all duration-300",style:{width:`${e.progress}%`}})}),s.jsxs("div",{className:"flex justify-between mt-1 text-xs text-slate-500",children:[s.jsx("span",{children:e.file_size?b(e.file_size):""}),s.jsxs("span",{children:[e.progress,"%"]})]})]},e.id)})}),l==="files"&&s.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm overflow-x-auto pb-1",children:[s.jsx("button",{onClick:()=>p(null,""),className:"text-slate-400 hover:text-white",children:"Home"}),d.map(e=>s.jsxs(C.Fragment,{children:[s.jsx("span",{className:"text-slate-600",children:"/"}),s.jsx("span",{className:"text-slate-200 whitespace-nowrap",children:e.name})]},e.id))]}),s.jsxs("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2",children:[d.length>0&&s.jsxs("button",{onClick:k,className:"w-full text-left p-3 rounded-lg bg-slate-800/30 hover:bg-slate-800/50 border border-slate-800 flex items-center gap-3",children:[s.jsx("span",{className:"text-xl",children:"üìÅ"})," ",s.jsx("span",{className:"text-slate-300",children:".."})]}),j.map(e=>{const t=e.kind==="drive#folder";return s.jsxs("div",{onClick:()=>t?p(e.id,e.name):null,className:`w-full text-left p-3 rounded-lg bg-slate-800/30 border border-slate-700 flex items-center justify-between gap-3 group ${t?"cursor-pointer hover:bg-slate-800/50":""}`,children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.jsx("span",{className:"text-xl flex-shrink-0",children:t?"üìÅ":"üìÑ"}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:"text-slate-200 truncate pr-2",title:e.name,children:e.name}),s.jsxs("p",{className:"text-xs text-slate-500",children:[b(e.size)," ‚Ä¢ ",new Date(e.created_time).toLocaleDateString()]})]})]}),!t&&s.jsx("a",{href:`/api/proxy/download/${e.id}`,target:"_blank",download:!0,className:"px-3 py-1 bg-sky-600 hover:bg-sky-500 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity",children:"Download"})]},e.id)})]})]})]})})]})}):null};export{_ as CloudDashboard};
