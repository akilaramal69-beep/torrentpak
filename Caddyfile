{
    email {$EMAIL}
}

# Main Search Site
{$DOMAIN} {
    reverse_proxy app:5000
    
    header {
        Strict-Transport-Security "max-age=63072000"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        X-Frame-Options "DENY"
        -Server
    }
}

# Jackett Subdomain
jackett.{$DOMAIN} {
    reverse_proxy jackett:9117 {
        header_up X-Forwarded-Host {host}
        header_up X-Forwarded-Proto {scheme}
    }
}

# WWW redirect
www.{$DOMAIN} {
    redir https://{$DOMAIN}{uri} permanent
}

# Fallback for IP access (No SSL)
:80 {
    reverse_proxy app:5000
    # Allow Jackett access via IP/jackett if needed
    handle_path /jackett* {
        reverse_proxy jackett:9117
    }
}
